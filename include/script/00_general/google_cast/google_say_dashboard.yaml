google_say_dashboard:
  alias: "00 ðŸ”Š TTS via Dashboard"
  description: Script to send TTS message via dashboard.
  icon: mdi:cast-audio
  mode: single
  variables:
    boolean:
      - input_boolean.keuken_hub
      - input_boolean.slaapkamer_hub
      - input_boolean.pepijn_mini
      - input_boolean.woonkamer_mini
      - input_boolean.zolder_groep
      - input_boolean.zolder_mini_marleen
      - input_boolean.zolder_mini_martijn
      - input_boolean.floris_mini
      - input_boolean.beneden_groep
      - input_boolean.boven_groep
      - input_boolean.huis_groep
  sequence:
    - alias: "Change volume while casting?"
      choose:
        - conditions:
            - alias: "Input boolean on?"
              condition: state
              entity_id: input_boolean.tts_volume
              state: "on"
          sequence:
            - service: script.turn_on
              target:
                entity_id: script.google_home_say
              data:
                variables:
                  tts_message: "{{ states('input_text.tts_message') }}"
                  tts_volume: "{{ states('input_number.tts_volume') | float(25) / 100 | round(2) }}"
                  tts_target: >
                    {% if is_state('input_select.dropdown_google_say', 'Geavanceerd kiezen') %}
                      {{ 
                          expand(boolean) 
                              | selectattr('state', 'eq', 'on') 
                              | map(attribute='entity_id') 
                              | list
                              | replace('input_boolean', 'media_player')
                      }}
                    {% else %}
                      {{ 'media_player.' ~ ( states('input_select.dropdown_google_say') | lower | replace(' ', '_') ) }}
                    {% endif %}
                  restore_volume_all: "{{ is_state('input_boolean.restore_volume_all', 'on') }}"
                  volume_non_playing: "{{ states('input_number.volume_non_playing') | float(25) / 100 | round(2) }}"
      default:
        - service: script.turn_on
          target:
            entity_id: script.google_home_say
          data:
            variables:
              tts_message: "{{ states('input_text.tts_message') }}"
              tts_target: >
                {% if is_state('input_select.dropdown_google_say', 'Geavanceerd kiezen') %}
                  {{ 
                      expand(boolean) 
                          | selectattr('state', 'eq', 'on') 
                          | map(attribute='entity_id') 
                          | list
                          | replace('input_boolean', 'media_player')
                  }}
                {% else %}
                  {{ 'media_player.' ~ ( states('input_select.dropdown_google_say') | lower | replace(' ', '_') ) }}
                {% endif %}
    - service: input_number.set_value
      target:
        entity_id: input_number.tts_volume
      data:
        value: 25
    - service: input_text.set_value
      target:
        entity_id: input_text.tts_message
      data:
        value: ""
    - service: homeassistant.turn_off
      target:
        entity_id: "{{ boolean }}"
