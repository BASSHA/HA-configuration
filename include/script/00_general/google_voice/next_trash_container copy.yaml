dishwasher_remaining_time_routine:
  alias: "00 ðŸ”Š TTS for remaining time dishwasher (Google Home)"
  icon: mdi:liquid-spot
  sequence:
    - variables:
        message: >
          {% if is_state('timer.vaatwasser_timer', 'active') and is_state('binary_sensor.dishwasher_active', 'on') %}
            {% set remaining = state_attr('timer.vaatwasser_timer', 'finishes_at') | as_timestamp - now() | as_timestamp %}
            {% set hours = remaining | timestamp_custom('%H') | int %}
            {% set minutes = remaining | timestamp_custom('%M') | int %}
            "De vaatwasser is over {{ '' if hours == 0 else hours ~ ' uur' }} en {{ minutes }} {{ 'minuten' if minutes > 0 else 'minuut' }} klaar." 
          {% elif is_state('timer.vaatwasser_timer', 'active')  %}
            "De vaatwasser is nu elk moment klaar"
          {% else %}
            " De vaatwasser is niet actief "
          {% endif %}
    - alias: "TTS for speaker voice command"
      service: script.google_home_say_voice
      data:
        tts_message: "{{ message }}"
        tts_volume: 35
