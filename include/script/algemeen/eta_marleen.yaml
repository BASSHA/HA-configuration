eta_marleen_script:
  alias: "Algemeen - ETA Marleen"
  icon: mdi:car
  sequence:
    - variables:
        external_url: !secret ha_url
    - variables:
        message: >
          {% set eta = (as_timestamp(now()) + 60 * states ('sensor.marleen_naar_huis') | float(0)) | timestamp_custom('%H:%M') %}
          {% if is_state('person.marleen', 'home') %}
            Marleen is al thuis
          {% elif is_state_attr('proximity.marleen', 'dir_of_travel', 'towards') %}
            Marleen is om {{ eta }} thuis.
          {% elif is_state_attr('proximity.marleen', 'dir_of_travel', 'away_from') %}
            Marleen gaat de verkeerde kant op, maar als hij nu omdraait is ze om {{ eta }} thuis.
          {% else %}
            Marleen is nog niet onderweg, maar als hij nu vertrekt is ze om {{ eta }} thuis.           
          {% endif %}
    - alias: "Notificatie telefoon Marleen"
      service: notify.join_pixel5
      data:
        title: "ETA Marleen"
        message: "{{ message }}"
        data:
          icon: "{{ external_url }}/local/pictures/auto.png"
          smallicon: "{{ external_url }}/local/pictures/auto.png"
    - condition: state
      entity_id: person.martijn
      state: "home"
    - alias: "TTS voor speaker voice command"
      service: script.google_home_say_voice
      data:
        tts_message: "{{ message }}"
        tts_volume: 35
